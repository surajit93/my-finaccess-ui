<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Documents | FinAccess</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --bg:#f8fafc;--card:#fff;--dark:#020617;
  --ink:#0f172a;--muted:#64748b;--brand:#2563eb;
  --border:#e2e8f0;--radius:14px;
  --shadow:0 20px 40px rgba(2,6,23,.08);
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--ink)
}
.page{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
aside{
  background:var(--dark);color:#e5e7eb;padding:32px
}
aside h1{margin:0 0 6px}
aside p{font-size:13px;color:#cbd5f5}
nav a{
  display:block;color:#cbd5f5;text-decoration:none;
  padding:10px;border-radius:10px
}
nav a:hover{background:#1e293b}
main{padding:48px}
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:28px;
  max-width:800px
}
label{
  font-size:13px;color:var(--muted);
  display:block;margin-bottom:6px
}
select,input[type=file]{
  width:100%;
  padding:12px;
  border:1px solid var(--border);
  border-radius:10px;
  margin-bottom:14px
}
button{
  background:var(--brand);
  color:#fff;
  border:none;
  padding:12px 16px;
  border-radius:10px;
  font-weight:600;
  cursor:pointer
}
.status{font-size:13px;margin-top:8px}
.note{
  margin-top:18px;
  font-size:12px;
  color:var(--muted)
}
@media(max-width:900px){
  .page{grid-template-columns:1fr}
  aside{display:none}
}
</style>
</head>

<body onload="init()">

<div class="page">

<aside>
  <h1>Documents</h1>
  <p>Encrypted & consented storage</p>
  <nav>
    <a href="./dashboard.html">Dashboard</a>
    <a href="./profile.html">Profile</a>
    <a href="./consents.html">Consents</a>
  </nav>
</aside>

<main>
<div class="card">
  <h2>Upload Document</h2>

  <label>Document Type</label>
  <select id="docType">
    <option value="">Select</option>
    <option value="PAN">PAN Card</option>
    <option value="AADHAAR">Aadhaar</option>
    <option value="BANK_STATEMENT">Bank Statement</option>
    <option value="SALARY_SLIP">Salary Slip</option>
    <option value="ITR">Income Tax Return</option>
  </select>

  <label>Select File (PDF / Image)</label>
  <input type="file" id="docFile" accept=".pdf,image/*" />

  <button onclick="uploadDocument()">Upload</button>

  <div id="status" class="status"></div>

  <div class="note">
    Documents are encrypted at rest, access-logged, and shared
    only with explicit consent. You may revoke access anytime.
  </div>
</div>
</main>

</div>

<script>
const API_BASE = "https://my-finaccess-production.up.railway.app";
let APP_CONTEXT={borrowerId:null};

function requireAuth(){
  const t=localStorage.getItem("auth_token");
  if(!t){location.href="./login.html"}
  return t;
}

async function init(){
  const token=requireAuth();

  // resolve borrower context (existing backend behaviour)
  const r=await fetch(`${API_BASE}/borrowers/me`,{
    headers:{Authorization:`Bearer ${token}`}
  });
  if(r.ok){
    const b=await r.json();
    APP_CONTEXT.borrowerId=b.id;
  }
}

function setStatus(msg,type){
  status.textContent=msg||"";
  status.style.color=
    type==="error"?"#dc2626":
    type==="success"?"#16a34a":"#0284c7";
}

async function uploadDocument(){
  const token=requireAuth();

  if(!APP_CONTEXT.borrowerId){
    setStatus("Borrower profile missing","error");
    return;
  }
  if(!docType.value){
    setStatus("Select document type","error");
    return;
  }
  if(!docFile.files[0]){
    setStatus("Select a file","error");
    return;
  }

  setStatus("Uploadingâ€¦");

  const form=new FormData();
  form.append("docType",docType.value);
  form.append("file",docFile.files[0]);

  const r=await fetch(
    `${API_BASE}/documents/borrower/${APP_CONTEXT.borrowerId}/upload`,
    {
      method:"POST",
      headers:{Authorization:`Bearer ${token}`},
      body:form
    }
  );

  if(!r.ok){
    setStatus("Upload failed","error");
    return;
  }

  setStatus("Document uploaded","success");
  docFile.value="";
  docType.value="";
}
</script>

</body>
</html>
