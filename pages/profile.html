<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Borrower Profile | FinAccess</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --bg:#f8fafc;--card:#fff;--dark:#020617;
  --ink:#0f172a;--muted:#64748b;--brand:#2563eb;
  --border:#e2e8f0;--radius:14px;
  --shadow:0 20px 40px rgba(2,6,23,.08);
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--ink)
}
.page{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
aside{
  background:var(--dark);color:#e5e7eb;padding:32px
}
aside h1{margin:0 0 6px}
aside p{font-size:13px;color:#cbd5f5}
nav a{
  display:block;color:#cbd5f5;text-decoration:none;
  padding:10px;border-radius:10px
}
nav a:hover{background:#1e293b}
main{padding:48px}
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:28px;
  max-width:800px
}
label{
  font-size:13px;
  color:var(--muted);
  display:block;
  margin-bottom:6px
}
input,select{
  width:100%;
  padding:12px;
  border:1px solid var(--border);
  border-radius:10px;
  margin-bottom:14px
}
button{
  background:var(--brand);
  color:#fff;
  border:none;
  padding:12px 16px;
  border-radius:10px;
  font-weight:600;
  cursor:pointer
}
.status{font-size:13px;margin-top:8px}
.note{
  margin-top:20px;
  font-size:12px;
  color:var(--muted)
}
.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px
}
@media(max-width:900px){
  .page{grid-template-columns:1fr}
  aside{display:none}
  .row{grid-template-columns:1fr}
}
</style>
</head>

<body onload="requireAuth()">

<div class="page">

<aside>
  <h1>Profile</h1>
  <p>India KYC & DPDP controls</p>
  <nav>
    <a href="./dashboard.html">Dashboard</a>
    <a href="./documents.html">Documents</a>
    <a href="./consents.html">Consents</a>
  </nav>
</aside>

<main>
<div class="card">
  <h2>Borrower Profile</h2>

  <label>Full Name</label>
  <input id="fullName" placeholder="As per PAN / Aadhaar" />

  <div class="row">
    <div>
      <label>Date of Birth</label>
      <input id="dob" type="date" />
    </div>
    <div>
      <label>Gender</label>
      <select id="gender">
        <option value="">Select</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
        <option value="other">Other</option>
        <option value="unknown">Prefer not to say</option>
      </select>
    </div>
  </div>

  <label>PAN (last 4 characters)</label>
  <input id="panLast4" maxlength="4" placeholder="e.g. 1234" />

  <button onclick="saveProfile()">Save Profile</button>

  <div id="status" class="status"></div>

  <div class="note">
    Your data is stored securely. You can revoke visibility or delete your
    profile anytime under DPDP guidelines.
  </div>
</div>
</main>

</div>

<script>
const API_BASE="https://my-finaccess.workers.dev";

function requireAuth(){
  if(!localStorage.getItem("auth_token")){
    location.href="./login.html";
  }
}

function setStatus(msg,type){
  status.textContent=msg||"";
  status.style.color=
    type==="error"?"#dc2626":
    type==="success"?"#16a34a":"#0284c7";
}

async function saveProfile(){
  const token=localStorage.getItem("auth_token");

  if(!fullName.value || !dob.value){
    setStatus("Name and DOB required","error");
    return;
  }

  if(panLast4.value && !/^[A-Z0-9]{4}$/i.test(panLast4.value)){
    setStatus("PAN last 4 invalid","error");
    return;
  }

  setStatus("Savingâ€¦");

  const res=await fetch(`${API_BASE}/borrowers`,{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization:`Bearer ${token}`
    },
    body:JSON.stringify({
      fullName:fullName.value.trim(),
      dateOfBirth:dob.value,
      gender:gender.value || "unknown",
      panLast4:panLast4.value || null
    })
  });

  if(!res.ok){
    setStatus("Save failed","error");
    return;
  }

  setStatus("Profile saved","success");
}
</script>

</body>
</html>
